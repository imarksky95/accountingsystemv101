"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[852],{4852:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var r=a(2555),n=a(5043),o=a(6330),i=a(6446),l=a(5865),c=a(3336),s=a(1045),d=a(1906),p=a(5795),u=a(1449),m=a(9336),h=a(35),v=a(6600),g=a(5316),A=a(8357),f=a(9347),x=a(4739),y=a(9927),b=a(579);const w=["Freelancer","Sole Proprietor","Corporation","Non Profit Organization"];console.debug&&console.debug("Settings: resolved API_BASE =",x.tE||"(empty, using fallback)");const _=()=>{const{setCompanyName:e}=(0,o.P)(),[t,a]=(0,n.useState)({logo:"",company_name:"",address:"",tin:"",company_type:""}),[h,v]=(0,n.useState)(null),g=(0,n.useRef)(null),[A,f]=(0,n.useState)(!1),[_,j]=(0,n.useState)(!1),C=e=>{const{name:t,value:n}=e.target;a(e=>(0,r.A)((0,r.A)({},e),{},{[t]:n}))};return(0,n.useEffect)(()=>{let t=!0;return(async()=>{try{const r=await(0,x.S)("/api/company-profile"),n=await r.json();if(!t)return;a({logo:n.logo||"",company_name:n.company_name||n.NAME||n.name||"",address:n.address||"",tin:n.tin||"",company_type:n.company_type||n.TYPE||""}),v(n.logo||null),n.company_name&&e(n.company_name)}catch(r){console.debug("Settings: failed to load profile",r)}})(),()=>{t=!1}},[e]),(0,b.jsxs)(i.A,{p:2,children:[(0,b.jsx)(l.A,{variant:"h5",gutterBottom:!0,children:"Settings"}),(0,b.jsxs)(c.A,{sx:{p:2,mb:2},children:[(0,b.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Company Profile"}),(0,b.jsxs)(i.A,{display:"flex",alignItems:"center",mb:2,children:[(0,b.jsx)(s.A,{src:h||void 0,sx:{width:64,height:64,mr:2}}),(0,b.jsxs)(d.A,{variant:"contained",component:"label",children:["Upload Logo",(0,b.jsx)("input",{type:"file",accept:"image/*",hidden:!0,ref:g,onChange:e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){const e=["image/png","image/jpeg","image/jpg","image/webp"],t=Number({NODE_ENV:"production",PUBLIC_URL:"/accountingsystemv101",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_COMPANY_LOGO_MAX_BYTES||1048576);if(!e.includes(n.type))return void alert("Unsupported logo type. Allowed: png, jpeg, webp");if(n.size>t)return void alert("Selected logo is too large (max ".concat(t," bytes)"));const o=new FileReader;o.onload=e=>{var t;const n=null===(t=e.target)||void 0===t?void 0:t.result;a(e=>(0,r.A)((0,r.A)({},e),{},{logo:n})),v(n)},o.readAsDataURL(n)}}})]})]}),(0,b.jsx)(p.A,{label:"Company Name",name:"company_name",value:t.company_name,onChange:C,fullWidth:!0,margin:"dense"}),(0,b.jsx)(p.A,{label:"Company Address",name:"address",value:t.address,onChange:C,fullWidth:!0,margin:"dense"}),(0,b.jsx)(p.A,{label:"Company TIN#",name:"tin",value:t.tin,onChange:C,fullWidth:!0,margin:"dense"}),(0,b.jsx)(p.A,{select:!0,label:"Company Type",name:"company_type",value:t.company_type,onChange:e=>{a(t=>(0,r.A)((0,r.A)({},t),{},{company_type:e.target.value}))},fullWidth:!0,margin:"dense",children:w.map(e=>(0,b.jsx)(u.A,{value:e,children:e},e))}),(0,b.jsx)(i.A,{mt:2,children:(0,b.jsx)(d.A,{variant:"contained",color:"primary",onClick:async()=>{f(!0);try{const n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};let o;try{if(o=await(0,x.S)("/api/company-profile",n),!o.ok)throw new Error("Save failed: ".concat(o.status))}catch(r){throw r}const i=await o.json();if(!o.ok)throw new Error(i.message||"Save failed");a({logo:i.logo||"",company_name:i.company_name||"",address:i.address||"",tin:i.tin||"",company_type:i.company_type||""}),v(i.logo||null),i.company_name&&e(i.company_name),alert("Company Profile saved!")}catch(n){console.error("Save profile error",n),alert("Failed to save Company Profile: "+(n.message||"unknown"))}finally{f(!1)}},disabled:A,children:A?"Saving...":"Save"})})]}),(0,b.jsx)(m.A,{}),(0,b.jsxs)(c.A,{sx:{p:2,mb:2,mt:2},children:[(0,b.jsx)(l.A,{variant:"h6",children:"Tax Setup"}),(0,b.jsx)(l.A,{color:"textSecondary",children:"Tax setup options will be managed here."})]}),(0,b.jsx)(m.A,{}),(0,b.jsxs)(c.A,{sx:{p:2,mb:2,mt:2},children:[(0,b.jsx)(l.A,{variant:"h6",children:"Account Settings"}),(0,b.jsx)(l.A,{color:"textSecondary",children:"Account settings will be managed here."}),(0,b.jsx)(i.A,{mt:2,children:(0,b.jsx)(d.A,{variant:"outlined",onClick:()=>j(!0),children:"Edit Account"})})]}),(0,b.jsx)(m.A,{}),(0,b.jsx)(c.A,{sx:{p:2,mb:2,mt:2},children:(0,b.jsx)(y.default,{})}),(0,b.jsx)(S,{open:_,onClose:()=>j(!1)})]})};function S(e){let{open:t,onClose:a}=e;const[,o]=n.useState(!1),[l,c]=n.useState({full_name:"",email:"",mobile:"",reviewer_id:"",approver_id:"",reviewer_manual:"",approver_manual:""}),[s,u]=n.useState(!1),[m,y]=n.useState(!1),[w,_]=n.useState([]),[S,j]=n.useState([]);return n.useEffect(()=>{t&&(async()=>{try{o(!0);const t=localStorage.getItem("token")||"";let a;try{a=await fetch((0,x.c$)("/api/account"),{headers:{Authorization:t?"Bearer ".concat(t):""}})}catch(e){console.warn("AccountEditor: /api/account fetch failed to reach server",e),a=null}if(a&&a.ok){const e=await a.json();c(e||{}),u(!(!e||!e.reviewer_manual)),y(!(!e||!e.approver_manual))}else{try{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e),a={full_name:t.full_name||t.username||"",email:t.email||"",mobile:t.mobile||""};c(e=>(0,r.A)((0,r.A)({},e),a))}}catch(e){console.warn("AccountEditor: failed to parse localStorage user for fallback",e)}if(a&&null!==a)try{const e=await a.text();console.warn("AccountEditor: /api/account returned non-ok",a.status,e)}catch(e){}}try{const e=await fetch((0,x.c$)("/api/users/public?role_type=reviewer"));e.ok&&_(await e.json())}catch(e){console.warn("Failed to load reviewer options",e)}try{const e=await fetch((0,x.c$)("/api/users/public?role_type=approver"));e.ok&&j(await e.json())}catch(e){console.warn("Failed to load approver options",e)}}catch(e){console.error("AccountEditor load error",e)}finally{o(!1)}})()},[t]),(0,b.jsxs)(h.A,{open:t,onClose:a,fullWidth:!0,maxWidth:"sm",children:[(0,b.jsx)(v.A,{children:"Edit Account"}),(0,b.jsx)(g.A,{children:(0,b.jsxs)(i.A,{display:"flex",flexDirection:"column",gap:2,mt:1,children:[(0,b.jsx)(p.A,{label:"Full name",value:l.full_name||"",onChange:e=>c(t=>(0,r.A)((0,r.A)({},t),{},{full_name:e.target.value})),fullWidth:!0}),(0,b.jsx)(p.A,{label:"Email",value:l.email||"",onChange:e=>c(t=>(0,r.A)((0,r.A)({},t),{},{email:e.target.value})),fullWidth:!0}),(0,b.jsx)(p.A,{label:"Mobile",value:l.mobile||"",onChange:e=>c(t=>(0,r.A)((0,r.A)({},t),{},{mobile:e.target.value})),fullWidth:!0}),(0,b.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,children:[(0,b.jsx)("input",{type:"checkbox",id:"reviewerManual",checked:s,onChange:e=>{const t=e.target.checked;u(t),c(e=>(0,r.A)((0,r.A)({},e),{},{reviewer_manual:t&&e.reviewer_manual||"",reviewer_id:t?"":e.reviewer_id}))}}),(0,b.jsx)("label",{htmlFor:"reviewerManual",children:"Manual reviewer name"})]}),s?(0,b.jsx)(p.A,{label:"Reviewer (manual name)",value:l.reviewer_manual||"",onChange:e=>c(t=>(0,r.A)((0,r.A)({},t),{},{reviewer_manual:e.target.value})),fullWidth:!0}):(0,b.jsx)(A.A,{options:w,getOptionLabel:e=>e.full_name||e.username||"",value:w.find(e=>Number(e.user_id)===Number(l.reviewer_id))||null,onChange:(e,t)=>c(e=>(0,r.A)((0,r.A)({},e),{},{reviewer_id:t?t.user_id:""})),renderInput:e=>(0,b.jsx)(p.A,(0,r.A)((0,r.A)({},e),{},{label:"Reviewer (select)"})),freeSolo:!0}),(0,b.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,children:[(0,b.jsx)("input",{type:"checkbox",id:"approverManual",checked:m,onChange:e=>{const t=e.target.checked;y(t),c(e=>(0,r.A)((0,r.A)({},e),{},{approver_manual:t&&e.approver_manual||"",approver_id:t?"":e.approver_id}))}}),(0,b.jsx)("label",{htmlFor:"approverManual",children:"Manual approver name"})]}),m?(0,b.jsx)(p.A,{label:"Approver (manual name)",value:l.approver_manual||"",onChange:e=>c(t=>(0,r.A)((0,r.A)({},t),{},{approver_manual:e.target.value})),fullWidth:!0}):(0,b.jsx)(A.A,{options:S,getOptionLabel:e=>e.full_name||e.username||"",value:S.find(e=>Number(e.user_id)===Number(l.approver_id))||null,onChange:(e,t)=>c(e=>(0,r.A)((0,r.A)({},e),{},{approver_id:t?t.user_id:""})),renderInput:e=>(0,b.jsx)(p.A,(0,r.A)((0,r.A)({},e),{},{label:"Approver (select)"})),freeSolo:!0})]})}),(0,b.jsxs)(f.A,{children:[(0,b.jsx)(d.A,{onClick:a,children:"Cancel"}),(0,b.jsx)(d.A,{variant:"contained",onClick:async()=>{try{const e=localStorage.getItem("token")||"",t={full_name:l.full_name,email:l.email,mobile:l.mobile,reviewer_id:l.reviewer_id,approver_id:l.approver_id,reviewer_manual:l.reviewer_manual,approver_manual:l.approver_manual},r=await fetch((0,x.c$)("/api/account"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:e?"Bearer ".concat(e):""},body:JSON.stringify(t)});if(!r.ok){const e=await r.json().catch(()=>({}));return void alert(e.error||"Failed to save account")}alert("Account updated"),a()}catch(e){console.error("Account save error",e),alert("Failed to save account")}},children:"Save"})]})]})}},9336:(e,t,a)=>{a.d(t,{A:()=>A});var r=a(8587),n=a(8168),o=a(5043),i=a(8387),l=a(8610),c=a(7266),s=a(4535),d=a(8206),p=a(5658),u=a(579);const m=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],h=(0,s.Ay)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.absolute&&t.absolute,t[a.variant],a.light&&t.light,"vertical"===a.orientation&&t.vertical,a.flexItem&&t.flexItem,a.children&&t.withChildren,a.children&&"vertical"===a.orientation&&t.withChildrenVertical,"right"===a.textAlign&&"vertical"!==a.orientation&&t.textAlignRight,"left"===a.textAlign&&"vertical"!==a.orientation&&t.textAlignLeft]}})(e=>{let{theme:t,ownerState:a}=e;return(0,n.A)({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin"},a.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},a.light&&{borderColor:t.vars?"rgba(".concat(t.vars.palette.dividerChannel," / 0.08)"):(0,c.X4)(t.palette.divider,.08)},"inset"===a.variant&&{marginLeft:72},"middle"===a.variant&&"horizontal"===a.orientation&&{marginLeft:t.spacing(2),marginRight:t.spacing(2)},"middle"===a.variant&&"vertical"===a.orientation&&{marginTop:t.spacing(1),marginBottom:t.spacing(1)},"vertical"===a.orientation&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},a.flexItem&&{alignSelf:"stretch",height:"auto"})},e=>{let{ownerState:t}=e;return(0,n.A)({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}})},e=>{let{theme:t,ownerState:a}=e;return(0,n.A)({},a.children&&"vertical"!==a.orientation&&{"&::before, &::after":{width:"100%",borderTop:"thin solid ".concat((t.vars||t).palette.divider),borderTopStyle:"inherit"}})},e=>{let{theme:t,ownerState:a}=e;return(0,n.A)({},a.children&&"vertical"===a.orientation&&{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:"thin solid ".concat((t.vars||t).palette.divider),borderLeftStyle:"inherit"}})},e=>{let{ownerState:t}=e;return(0,n.A)({},"right"===t.textAlign&&"vertical"!==t.orientation&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},"left"===t.textAlign&&"vertical"!==t.orientation&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})}),v=(0,s.Ay)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.wrapper,"vertical"===a.orientation&&t.wrapperVertical]}})(e=>{let{theme:t,ownerState:a}=e;return(0,n.A)({display:"inline-block",paddingLeft:"calc(".concat(t.spacing(1)," * 1.2)"),paddingRight:"calc(".concat(t.spacing(1)," * 1.2)")},"vertical"===a.orientation&&{paddingTop:"calc(".concat(t.spacing(1)," * 1.2)"),paddingBottom:"calc(".concat(t.spacing(1)," * 1.2)")})}),g=o.forwardRef(function(e,t){const a=(0,d.b)({props:e,name:"MuiDivider"}),{absolute:o=!1,children:c,className:s,component:g=(c?"div":"hr"),flexItem:A=!1,light:f=!1,orientation:x="horizontal",role:y=("hr"!==g?"separator":void 0),textAlign:b="center",variant:w="fullWidth"}=a,_=(0,r.A)(a,m),S=(0,n.A)({},a,{absolute:o,component:g,flexItem:A,light:f,orientation:x,role:y,textAlign:b,variant:w}),j=(e=>{const{absolute:t,children:a,classes:r,flexItem:n,light:o,orientation:i,textAlign:c,variant:s}=e,d={root:["root",t&&"absolute",s,o&&"light","vertical"===i&&"vertical",n&&"flexItem",a&&"withChildren",a&&"vertical"===i&&"withChildrenVertical","right"===c&&"vertical"!==i&&"textAlignRight","left"===c&&"vertical"!==i&&"textAlignLeft"],wrapper:["wrapper","vertical"===i&&"wrapperVertical"]};return(0,l.A)(d,p.K,r)})(S);return(0,u.jsx)(h,(0,n.A)({as:g,className:(0,i.A)(j.root,s),role:y,ref:t,ownerState:S},_,{children:c?(0,u.jsx)(v,{className:j.wrapper,ownerState:S,children:c}):null}))});g.muiSkipListHighlight=!0;const A=g}}]);
//# sourceMappingURL=852.24d3ef84.chunk.js.map