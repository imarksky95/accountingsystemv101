"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[928],{469:(e,t,n)=>{n.d(t,{A:()=>x});var a=n(8587),c=n(8168),o=n(5043),r=n(8387),i=n(8610),s=n(4535),l=n(8206),d=n(6803),u=n(2532),h=n(2372);function p(e){return(0,h.Ay)("MuiListSubheader",e)}(0,u.A)("MuiListSubheader",["root","colorPrimary","colorInherit","gutters","inset","sticky"]);var A=n(579);const b=["className","color","component","disableGutters","disableSticky","inset"],m=(0,s.Ay)("li",{name:"MuiListSubheader",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"default"!==n.color&&t["color".concat((0,d.A)(n.color))],!n.disableGutters&&t.gutters,n.inset&&t.inset,!n.disableSticky&&t.sticky]}})(e=>{let{theme:t,ownerState:n}=e;return(0,c.A)({boxSizing:"border-box",lineHeight:"48px",listStyle:"none",color:(t.vars||t).palette.text.secondary,fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(14)},"primary"===n.color&&{color:(t.vars||t).palette.primary.main},"inherit"===n.color&&{color:"inherit"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.inset&&{paddingLeft:72},!n.disableSticky&&{position:"sticky",top:0,zIndex:1,backgroundColor:(t.vars||t).palette.background.paper})}),y=o.forwardRef(function(e,t){const n=(0,l.b)({props:e,name:"MuiListSubheader"}),{className:o,color:s="default",component:u="li",disableGutters:h=!1,disableSticky:y=!1,inset:x=!1}=n,g=(0,a.A)(n,b),j=(0,c.A)({},n,{color:s,component:u,disableGutters:h,disableSticky:y,inset:x}),_=(e=>{const{classes:t,color:n,disableGutters:a,inset:c,disableSticky:o}=e,r={root:["root","default"!==n&&"color".concat((0,d.A)(n)),!a&&"gutters",c&&"inset",!o&&"sticky"]};return(0,i.A)(r,p,t)})(j);return(0,A.jsx)(m,(0,c.A)({as:u,className:(0,r.A)(_.root,o),ref:t,ownerState:j},g))});y.muiSkipListHighlight=!0;const x=y},2928:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var a=n(2555),c=n(5043),o=n(3518),r=n(8076),i=n(2420),s=n(7392),l=n(6446),d=n(5865),u=n(1906),h=n(9650),p=n(3336),A=n(1806),b=n(4882),m=n(3460),y=n(35),x=n(6600),g=n(5316),j=n(5795),_=n(3193),f=n(9190),S=n(2221),v=n(1449),k=n(9347),C=n(469),w=n(3159),E=n(3471),N=n(2505),P=n(4739),I=n(579);console.debug&&console.debug("ChartOfAccounts: resolved API_BASE =",P.tE||"(empty, using fallback)");const O=[{label:"Asset",options:["Accounts Receivable","Bank","Cash","Fixed Asset","Input Tax","Other Current Asset","Stock"]},{label:"Equity",options:["Equity"]},{label:"Expense",options:["Cost Of Goods Sold","Expense","Other Expense"]},{label:"Income",options:["Income","Other Income"]},{label:"Liability",options:["Accounts Payable","Other Current Liability","Other Liability","Output Tax"]}],T=()=>{const[e,t]=(0,c.useState)([]),[n,T]=(0,c.useState)(!1),[L,F]=(0,c.useState)(!1),[M,R]=(0,c.useState)(null),[G,W]=(0,c.useState)({account_number:"",account_name:"",account_type:"",parent_id:""}),[q,z]=(0,c.useState)([]),D=async()=>{T(!0);const e=await(0,P.S)("/api/coa");let n;try{n=await e.json(),console.log("COA API response:",n)}catch(a){n=[],console.error("Failed to parse COA API response:",a)}t(Array.isArray(n)?n:[]),T(!1)},H=async()=>{const e=await(0,P.S)("/api/coa/all/simple");let t;try{t=await e.json()}catch(n){t=[]}console.log("Parent options API response:",t),z(Array.isArray(t)?t:[])};(0,c.useEffect)(()=>{D(),H()},[]);const B=e=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e?(R(e.coa_id),W({account_number:e.account_number||"",account_name:e.account_name,account_type:e.account_type,parent_id:e.parent_id?String(e.parent_id):""})):(R(null),W({account_number:"",account_name:"",account_type:"",parent_id:""})),F(!0)},$=()=>{F(!1),R(null),W({account_number:"",account_name:"",account_type:"",parent_id:""})},J=e=>{const{name:t,value:n}=e.target;W((0,a.A)((0,a.A)({},G),{},{[t]:n}))},U=e=>{const{name:t,value:n}=e.target;W((0,a.A)((0,a.A)({},G),{},{[t]:n}))};const V=function(e){const t={},n=[];return e.forEach(e=>{t[e.coa_id]=(0,a.A)((0,a.A)({},e),{},{children:[]})}),e.forEach(e=>{e.parent_id&&t[e.parent_id]?t[e.parent_id].children.push(t[e.coa_id]):n.push(t[e.coa_id])}),n}(e);return(0,I.jsxs)(l.A,{p:2,children:[(0,I.jsx)(d.A,{variant:"h5",gutterBottom:!0,children:"Chart of Accounts"}),(0,I.jsx)(u.A,{variant:"contained",startIcon:(0,I.jsx)(N.A,{}),onClick:()=>B(),sx:{mb:2},children:"Add Account"}),(0,I.jsx)(h.A,{component:p.A,children:(0,I.jsxs)(A.A,{children:[(0,I.jsx)(b.A,{children:(0,I.jsxs)(r.A,{children:[(0,I.jsx)(i.A,{children:"Account Number"}),(0,I.jsx)(i.A,{children:"Account Name"}),(0,I.jsx)(i.A,{children:"Account Type"}),(0,I.jsx)(i.A,{children:"Parent Account"}),(0,I.jsx)(i.A,{children:"Created At"}),(0,I.jsx)(i.A,{align:"right",children:"Actions"})]})}),(0,I.jsxs)(m.A,{children:[function e(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.flatMap((a,c)=>{const l=c===t.length-1,d=(0,I.jsx)("span",{style:{display:"inline-block",position:"relative",width:24*n+16,height:24,verticalAlign:"middle"},children:n>0&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("span",{style:{position:"absolute",left:24*(n-1)+7,top:0,height:l?12:24,width:2,background:"#bdbdbd",zIndex:1,borderRadius:1,opacity:.7}}),(0,I.jsx)("span",{style:{position:"absolute",left:24*(n-1)+7,top:10,width:16,height:2,background:"#bdbdbd",zIndex:2,borderRadius:1,opacity:.7}})]})});return[(0,I.jsxs)(r.A,{children:[(0,I.jsx)(i.A,{children:a.account_number}),(0,I.jsxs)(i.A,{children:[d,(0,I.jsx)("span",{style:{fontWeight:0===n?500:400},children:a.account_name})]}),(0,I.jsx)(i.A,{children:a.account_type}),(0,I.jsx)(i.A,{children:a.parent_account_name||"-"}),(0,I.jsx)(i.A,{children:(0,o.V)(a.created_at)}),(0,I.jsxs)(i.A,{align:"right",children:[(0,I.jsx)(s.A,{onClick:()=>B(a),children:(0,I.jsx)(w.A,{})}),(0,I.jsx)(s.A,{color:"error",onClick:()=>(async e=>{await fetch((0,P.c$)("/api/coa/".concat(e)),{method:"DELETE"}),await D(),await H()})(a.coa_id),children:(0,I.jsx)(E.A,{})})]})]},a.coa_id),...a.children&&a.children.length>0?e(a.children,n+1,l):[]]})}(V),0===e.length&&!n&&(0,I.jsx)(r.A,{children:(0,I.jsx)(i.A,{colSpan:5,align:"center",children:"No accounts found."})})]})]})}),(0,I.jsxs)(y.A,{open:L,onClose:$,children:[(0,I.jsx)(x.A,{children:M?"Edit Account":"Add Account"}),(0,I.jsxs)(g.A,{children:[(0,I.jsx)(j.A,{autoFocus:!0,margin:"dense",label:"Account Number",name:"account_number",value:G.account_number,onChange:J,fullWidth:!0,required:!0}),(0,I.jsx)(j.A,{margin:"dense",label:"Account Name",name:"account_name",value:G.account_name,onChange:J,fullWidth:!0,required:!0}),(0,I.jsxs)(_.A,{fullWidth:!0,margin:"dense",required:!0,children:[(0,I.jsx)(f.A,{id:"account-type-label",children:"Account Type"}),(0,I.jsx)(S.A,{labelId:"account-type-label",name:"account_type",value:G.account_type,label:"Account Type",onChange:U,MenuProps:{PaperProps:{style:{maxHeight:300}}},children:O.map(e=>[(0,I.jsx)(C.A,{children:e.label},e.label),e.options.map(e=>(0,I.jsx)(v.A,{value:e,children:e},e))])})]}),(0,I.jsxs)(_.A,{fullWidth:!0,margin:"dense",children:[(0,I.jsx)(f.A,{id:"parent-account-label",children:"Parent Account"}),(0,I.jsxs)(S.A,{labelId:"parent-account-label",name:"parent_id",value:G.parent_id,label:"Parent Account",onChange:U,children:[(0,I.jsx)(v.A,{value:"",children:(0,I.jsx)("em",{children:"None"})}),(()=>{const e=(Array.isArray(q)?q:[]).filter(e=>!M||e.coa_id!==M);return 0===e.length?(0,I.jsx)(v.A,{disabled:!0,value:"",children:(0,I.jsx)("em",{children:"No available parent accounts"})}):e.map(e=>(0,I.jsx)(v.A,{value:e.coa_id,children:e.account_name},e.coa_id))})()]})]})]}),(0,I.jsxs)(k.A,{children:[(0,I.jsx)(u.A,{onClick:$,children:"Cancel"}),(0,I.jsx)(u.A,{onClick:async()=>{const e={account_number:G.account_number,account_name:G.account_name,account_type:G.account_type,parent_id:G.parent_id?Number(G.parent_id):null};try{let t;if(t=M?await fetch((0,P.c$)("/api/coa/".concat(M)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}):await fetch((0,P.c$)("/api/coa"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),!t.ok){const e=await t.json();if(e&&e.error&&e.error.includes("Duplicate Account Number"))return void alert("Duplicate Account Number");throw new Error("Failed to save account.")}await D(),await H(),$()}catch(t){alert("Failed to save account. Please try again.")}},variant:"contained",children:M?"Update":"Add"})]})]})]})}},3518:(e,t,n)=>{function a(e){if(!e)return"";const t="string"===typeof e?new Date(e):e;if(Number.isNaN(t.getTime()))return"";const n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),c=String(t.getFullYear());return"".concat(n,"/").concat(a,"/").concat(c)}n.d(t,{V:()=>a})}}]);
//# sourceMappingURL=928.ab094466.chunk.js.map